---
title: "CrowNestlingClimateModels"
author: "Justin Mann"
date: "2022-12-03"
output: html_document
---

```{r libraries, include=FALSE}
library(tidyverse)
library(dplyr)
library(broom) #tidy() to create tibbles from model summaries
library(car)
library(lme4) #frequentist models  
library(sjPlot) #plot_model & tab_model (blue = #377EB8)
library(ggpubr) #ggarrange
library(glmmTMB) #zi & overdispersed models
library(lmerTest) #lmerTest::step
library(ggeffects) #ggpredict
#PACKAGES FOR BAYESIAN MODELS
# library(rstanarm) #stan models
# library(shinystan) #stan model evaluation
#launch_shinystan_demo()
# library(loo) #use loo() to compare fits between bayesian models
library(plotly)
library(MuMIn) #dredge() for unsupervised model selection
library(AICcmodavg) #aictab() for AICc model comparisons
library(DHARMa)
theme_set(theme_classic())
```


```{r forest.plot function}
forest.plot <- function(mdl){
  mdl.df <- tidy(mdl, quick = FALSE)
  ci <- as_tibble(confint(mdl))
  mdl.df$ci.lower <- ci$`2.5 %`
  mdl.df$ci.upper <- ci$`97.5 %`
  mdl.df <- mdl.df[-1,]
  
  ggplot(data = mdl.df)+
    geom_pointrange(aes(x=term, y=estimate, ymin=ci.lower, ymax=ci.upper), size=1, shape=20)+
    coord_flip()+
    geom_hline(yintercept = 0, color="red",size=1)+
    ggtitle("Parameter estimates")+
    theme(plot.title = element_text(size = 22),
        axis.text.x = element_text(size = 18),
        axis.title.x = element_blank(),
        axis.text.y = element_text(size = 18),
        axis.title.y = element_blank(),
        plot.margin = margin(15,15,15,15))
  
}
```

```{r mdl.tbl function}
mdl.tbl <- function(mdl){
  mdl.df <- tidy(mdl, quick = FALSE)
  ci <- as_tibble(confint(mdl))
  mdl.df$ci.lower <- ci$`2.5 %`
  mdl.df$ci.upper <- ci$`97.5 %`
  mdl.df <- mdl.df[-1,]
  print(mdl.df)
}
```

<br> 


## Crow Nestling Climate Models 


### Read in data

```{r dataframes}
#Both sexes
B.df <- read.csv("CrowNestlingClimate_BothSexesClean.csv",h=TRUE)
B.df$AllSex <- as.factor(B.df$AllSex)
summary(B.df)

#Males
M.df <- subset(B.df, AllSex=="M")

#Females 
F.df <- subset(B.df, AllSex=="F")
```
<br>


## Bio Symposium Poster Models 
<br>

### Female Models

```{r F upper bill GDD2 model}
# Upper bill GDD model
F.UB2.mdl <- lm(UB ~ GDDSum12_22*PrecipSum12_22 + Weight, data = F.df)
summary(F.UB2.mdl)
# Precipitation has a negative effect, mainly when it's cold
```
<br>

```{r F bill nares to tip GDD2 model}
# Bill nares to tip model
F.BNT2.mdl <- lm(BillNT ~ GDDSum12_22*PrecipSum12_22 + Weight, data = F.df)
summary(F.BNT2.mdl)
# Precipitation has a negative effect, mainly when it's cold
```
<br>

```{r F upper bill surface area GDD2 model}
# Upper bill surface area model
F.UBS2.mdl <- lm(UBS ~ GDDSum12_22*PrecipSum12_22 + Weight, data = F.df)
summary(F.UBS2.mdl)
# Precipitation has a negative effect, mainly when it's cold
```
<br>

```{r F bill depth GDD2 model}
# Bill depth model
F.BD2.mdl <- lm(BillDepth ~ GDDSum12_22*PrecipSum12_22 + Weight, data = F.df)
summary(F.BD2.mdl)
# Temperature is the only important climate variable
```
<br>

```{r F tarsus GDD2 model}
# Tarsus GDD2 model
F.Tarsus2.mdl <- lm(Tarsus ~ GDDSum12_22*PrecipSum12_22 + Weight, data = F.df)
summary(F.Tarsus2.mdl)
# Climate variables have no effect
```
<br>



### Male Models

```{r M upper bill GDD2 model}
# Upper bill model
M.UB2.mdl <- lm(UB ~ GDDSum12_22*PrecipSum12_22 + Weight, data = M.df)
summary(M.UB2.mdl)
# Weight is the only important predictor
```
<br>

```{r M bill nares to tip GDD2 model}
# Bill nares to tip model
M.BNT2.mdl <- lm(BillNT ~ GDDSum12_22*PrecipSum12_22 + Weight, data = M.df)
summary(M.BNT2.mdl)
# Weight is the only important predictor
```
<br>

```{r M upper bill surface area GDD2 model}
# Upper bill surface area model
M.UBS2.mdl <- lm(UBS ~ GDDSum12_22*PrecipSum12_22 + Weight, data = M.df)
summary(M.UBS2.mdl)
# Weight is the only important predictor
```
<br>

```{r M bill depth GDD2 model}
# Bill depth model
M.BD2.mdl <- lm(BillDepth ~ GDDSum12_22*PrecipSum12_22 + Weight, data = M.df)
summary(M.BD2.mdl)
# Temperature and the interaction between temp and precip are both important
```
<br>

```{r M tarsus GDD2 model}
# Tarsus model
M.Tarsus2.mdl <- lm(Tarsus ~ GDDSum12_22*PrecipSum12_22 + Weight, data = M.df)
summary(M.Tarsus2.mdl)
# Climate variables have no effect
```
<br>






