---
title: "Unsexed Nestling Analysis"
author: "Justin Mann"
date: "`r Sys.Date()`"
output: html_document
---

```{r libraries, echo=T, results="hide"}
library(tidyverse)
library(broom) #tidy() to create tibbles from model summaries
library(car) #vif (variance inflation factor for measuring covariance)
library(cowplot)
library(lme4) #frequentist models  
library(sjPlot) #plot_model & tab_model (blue = #377EB8)
library(ggpubr) #ggarrange for plot wraps
library(lmerTest) #lmerTest::step
library(ggeffects) #ggpredict
library(plotly) #ggplotly() to make interactive plots with scroll over ids
library(MuMIn) #dredge() for unsupervised model selection
library(AICcmodavg) #aictab() for AICc model comparisons
library(DHARMa) #model validation functions
library(DescTools) #Entropy() and MutInf()

#Libraries for Bayesian Models
library(rstanarm) #stan models
library(shinystan) #stan model evaluation
#launch_shinystan_demo()
library(loo) #use loo() to compare fits between bayesian models

#Clustering libraries
library(umap)
library(tsne)
library(ggfortify)#use autoplot() to visualize PCAs
library(stpm)#stochastic process model
theme_set(theme_classic()) #default plots with no gridlines
```
<br>

## Climate Data

```{r climate variables df}
clim.df <- read.csv("ClimateMetrics_AllMonths1989-2022.csv", h=TRUE)
clim.df$Date <- as.Date(clim.df$Date)
clim.df$Month <- lubridate::month(clim.df$Date)
clim.df <- clim.df %>% 
  relocate(Month, .after = Year)
breedingClim.df <- clim.df %>% 
  filter(between(Month, 3,5)) %>% 
  filter(between(JulDay, 71,151))
breedingClim.df$TotalPrecipCM <- breedingClim.df$PrecipCM + breedingClim.df$SnowfallCM
```

```{r write climate metrics csv for plotting}
write.csv(breedingClim.df, "ClimateMetrics_BreedingSeason1989-2022.csv", row.names = F)
```


```{r plot median max temp}
median(breedingClim.df$MaxC, na.rm=TRUE)
max.plot <- ggplot(data = breedingClim.df, aes(x=as.factor(Year), y=MaxC))+
  geom_boxplot()+
  geom_hline(yintercept = 13.89, color = "red", linetype = "dotted", linewidth = 1)+
  #ggtitle("Daily Maximum Temperatures across March, April, May and June")+
  ylab("Maximum Temperature (C)")+
  xlab("")+
  theme(axis.text.x = element_text(angle = 90))
```

```{r plot median min temp}
median(breedingClim.df$MinC, na.rm=TRUE)
min.plot <- ggplot(data = breedingClim.df, aes(x=as.factor(Year), y=MinC))+
  geom_boxplot()+
  geom_hline(yintercept = 1.67, color = "red", linetype = "dotted", size = 1)+
  #ggtitle("Daily Minimum Temperature across March, April, May and June")+
  ylab("Minimum Temperature (C)")+
  xlab("")+
  theme(axis.text.x = element_text(angle = 90))
min.plot
```


```{r plot precip}
median(breedingClim.df$PrecipCM, na.rm=TRUE)
precip.plot <- ggplot(data = clim.df, aes(x=as.factor(Year), y=PrecipCM))+
  geom_boxplot()+
  geom_hline(yintercept = 0.025, color = "red", linetype = "dotted", size = 1)+
  #ggtitle("Daily Minimum Temperature across March, April, May and June")+
  ylab("Precipitation (cm)")+
  xlab("")+
  theme(axis.text.x = element_text(angle = 90))
```

```{r wrap climate plots}
climate.wrap <- ggarrange(max.plot,min.plot,precip.plot, ncol = 1)
annotate_figure(climate.wrap, top = "Climate Conditions during the Breeding Season (12 March-31 May)")
```

## Nestling Data and Climate metrics

```{r dataframe}
df <- read.csv("CrowNestlingClimate_AllNestlingsCleaned&ClimateJoined.csv", h=TRUE)
df <- df[,-1]
#n=2035 nestlings, 39 variables
```

<br>

A column to hold decade bins for plotting

```{r creating decade bins}
df$Decades <- cut(df$Year, breaks = c(1988,1999,2010,2018), labels = c("89-99","00-10","11-18"))
df <- df %>% relocate(Decades, .before = Year)
```

<br>

## Normalize Continuous Data

Subtract each value from the mean (center) and divide it by the standard deviation

```{r scaling}
#categorical data  
unScaled.df <- df[,1:11]

#continuous data
dataToScale.df <- df[,12:40]

#scale continuous data
#?scale()
scaled.mat <- scale(dataToScale.df, center = TRUE, scale = TRUE)

#join unscaled and scaled data
scaled.df <- cbind(unScaled.df,scaled.mat)
```

<br>

Summarize the unscaled data

```{r data summary }
summary(df)
```

<br>

Summarize the scaled data

```{r scaled data summary}
summary(scaled.df)
```

<br>

```{r data frame with only sexed nestlings}
#Males Scaled
M.scaled.df <- subset(scaled.df, AllSex=="M")
#Males Unscaled
M.df <- subset(df, AllSex=="M")

#Females Scaled
F.scaled.df <- subset(scaled.df, AllSex=="F")
#Females Unscaled
F.df <- subset(df, AllSex=="F")

#Both sexes scaled
B.scaled.df <- rbind(F.scaled.df,M.scaled.df)
#Both sexes unscaled
B.df <- rbind(F.df,M.df)
```

<br>

## Climate PCA

```{r id columns and matrix for climate PCA}
climPCA.ids <- scaled.df %>% select(Year,HatchDateJul)
climPCA.mat <- scaled.df %>% select(MeanMaxTempIncubation,MaxTempMean1_11,MaxTempMean12_22,MeanMinTempIncubation,MinTempMean1_11,MinTempMean12_22,PrecipSumIncubation,PrecipSum1_11,PrecipSum12_22)
```

```{r PCAs}
#all climate variables
climPCA <- prcomp(climPCA.mat)
#max temps only
maxPCA <- prcomp(climPCA.mat[,1:3])
#min temps only
minPCA <- prcomp(climPCA.mat[4:6])
#precip only
precipPCA <- prcomp(climPCA.mat[,7:9])
```

```{r plot all clim vars}
autoplot(climPCA, colour=as.factor(climPCA.ids$Year),
         loadings = TRUE, loadings.colour = 'blue',
         loadings.label = TRUE, loadings.label.size = 3)

```

```{r plot max temp vars}
autoplot(maxPCA, colour=as.factor(climPCA.ids$Year),
         loadings = TRUE, loadings.colour = 'blue',
         loadings.label = TRUE, loadings.label.size = 3)

```

```{r plot min tmep vars}
autoplot(minPCA, colour=as.factor(climPCA.ids$Year),
         loadings = TRUE, loadings.colour = 'blue',
         loadings.label = TRUE, loadings.label.size = 3)

```

```{r plot precip vars}
autoplot(precipPCA, colour=as.factor(climPCA.ids$Year),
         loadings = TRUE, loadings.colour = 'blue',
         loadings.label = TRUE, loadings.label.size = 3)

```

## Bill Depth by sex

What is the mean bill depth of males and females?

```{r unscaled bill depth t test}
t.test(B.df$BD[B.df$AllSex=="M"], B.df$BD[B.df$AllSex=="F"])
```

<br>

Plot unscaled bill depth distributions for males and females with verticle lines showing the mean values.

```{r unscaled bill depth by sex plot}
ggplot(data = B.df, aes(x=BD, fill = AllSex))+
  geom_histogram(colour = "black", bins = 50)+
  geom_vline(xintercept = 12.55, color="#009E73", linetype="dashed", size=1)+
  geom_vline(xintercept = 12.98, color="#E69F00", linetype="dashed", size=1)+
  scale_fill_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))
```

<br>

Plot the residuals of a scaled model showing how weight and age explain bill depth.

```{r scaled bill depth residuals by sex}
#Scaled BD 
BDNoSex.scaled.mdl <- lm(data = B.scaled.df, BD ~ Weight + CalcAge)
BDNoSex.summ <- summary(BDNoSex.scaled.mdl)
B.scaled.df$BDNoSex.resids <- BDNoSex.summ$residuals

ggplot(data = B.scaled.df, aes(x=BDNoSex.resids,fill=AllSex))+
  geom_histogram(colour = "black", bins = 100)+
  scale_fill_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))+
  theme(plot.title = element_text(size = 22),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
```

```{r bill depth by weight scaled}
ggplot(data = B.scaled.df, aes(x=BD,y=BDNoSex.resids,color=AllSex))+
  geom_point()+
  scale_color_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))+
  theme(plot.title = element_text(size = 22),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
```

```{r t test scaled bill depth residuals}
mean(B.scaled.df$BDNoSex.resids[B.scaled.df$AllSex=="M"])
mean(B.scaled.df$BDNoSex.resids[B.scaled.df$AllSex=="F"])
t.test(B.scaled.df$BDNoSex.resids[B.scaled.df$AllSex=="M"],B.scaled.df$BDNoSex.resids[B.scaled.df$AllSex=="F"])
```

<br>

```{r truncated bill depth residuals}
TruncBD.df <- B.scaled.df %>% filter(between(BD,-1,1))
t.test(TruncBD.df$BDNoSex.resids[TruncBD.df$AllSex=="M"],TruncBD.df$BDNoSex.resids[TruncBD.df$AllSex=="F"])
```

```{r bill depth by bill depth residuals scaled}
ggplot(data = TruncBD.df, aes(x=BD,y=BDNoSex.resids,color=AllSex))+
  geom_point()+
  geom_jitter(width = 0.5)+
  scale_color_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))+
  theme(plot.title = element_text(size = 22),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
```

How to deal with the sex differences in the unsexed kids: 1. Classify clusters of years that are climatically similar. 2.

## Tarsus comparisons by sex

```{r unscaled tarsus t test}
t.test(B.df$Tarsus[B.df$AllSex=="M"], B.df$Tarsus[B.df$AllSex=="F"])
```

```{r unscaled tarsus by sex plot}
ggplot(data = B.df, aes(x=Tarsus, fill = AllSex))+
  geom_histogram(colour = "black", bins = 100)+
  geom_vline(xintercept = 58.006, color="#009E73", linetype="dashed", size=1)+
  geom_vline(xintercept = 59.9, color="#E69F00", linetype="dashed", size=1)+
  scale_fill_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))
```

```{r scaled tarsus residuals by sex}
#Scaled tarsus 
TarsusNoSex.scaled.mdl <- lm(data = B.scaled.df, Tarsus ~ Weight + CalcAge)
TarsusNoSex.summ <- summary(TarsusNoSex.scaled.mdl)
B.scaled.df$TarsusNoSex.resids <- TarsusNoSex.summ$residuals

ggplot(data = B.scaled.df, aes(x=TarsusNoSex.resids,fill=AllSex))+
  geom_histogram(colour = "black", bins = 100)+
  scale_fill_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))+
  theme(plot.title = element_text(size = 22),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
```

```{r tarsus by weight scaled}
ggplot(data = B.scaled.df, aes(x=Tarsus,y=TarsusNoSex.resids,color=AllSex))+
  geom_point()+
  scale_color_manual(values = c("#009E73","#E69F00"), labels = c("Female","Male"))+
  theme(plot.title = element_text(size = 22),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
```

```{r t test scaled tarsus residuals}
t.test(B.scaled.df$TarsusNoSex.resids[B.scaled.df$AllSex=="M"],B.scaled.df$TarsusNoSex.resids[B.scaled.df$AllSex=="F"])
```
<br>


## Unsupervised model selection

### What climate metrics best explain variation in bill shape? 

Since the strongest effects thus far have shown up in Time Period 2 (12-22 days post hatching), I'm going to use Time 2 for model selection tests.

```{r bill depth time 2 model selection}
#Min
MinTempBD.mdl <- lm(BD ~ MinTempMean12_22 * PrecipSum12_22 + CalcAge + Weight, data = scaled.df, na.action = "na.fail")
MaxTempBD.mdl <- lm(BD ~ MaxTempMean12_22 * PrecipSum12_22 + CalcAge + Weight, data = scaled.df, na.action = "na.fail")
GDDBD.mdl <- lm(BD ~ GDDSum12_22 * PrecipSum12_22 + CalcAge + Weight, data = scaled.df, na.action = "na.fail")
CDDBD.mdl <- lm(BD ~ CDDSum12_22 * PrecipSum12_22 + CalcAge + Weight, data = scaled.df, na.action = "na.fail")
HDDBD.mdl <- lm(BD ~ HDDSum12_22 * PrecipSum12_22 + CalcAge + Weight, data = scaled.df, na.action = "na.fail")
```

```{r bill depth time 2 model comparison}
BDTime2Models <- list(MinTempBD.mdl,MaxTempBD.mdl,GDDBD.mdl,CDDBD.mdl,HDDBD.mdl)
BDTime2ModelNames <- c('MinTempBD.mdl','MaxTempBD.mdl','GDDBD.mdl','CDDBD.mdl','HDDBD.mdl')
aictab(cand.set = BDTime2Models, modnames = BDTime2ModelNames, sort = TRUE)
```

Minimum Temperature Model fits the data best. GDD is second best, but the delta AICc is 11.43 between the two.

```{r MinTempBD.mdl summary}
summary(MinTempBD.mdl)
```
```{r}
MinTemp.pred <- ggpredict(MinTempBD.mdl, type = "fe", terms = ~ MinTempMean12_22)
MinTemp.pred
```
```{r}
ggplot(data = MinTemp.pred, aes(x,predicted))+
  geom_point(data = scaled.df, aes(x=MinTempMean12_22, y=BD))+
  geom_line(color = "red")+
  geom_ribbon(aes(ymin=conf.low,ymax=conf.high), fill = "red", alpha = 0.1)+
  scale_y_continuous(limits = c(-4,4))
```


```{r GDDBD.mdl summary}
summary(GDDBD.mdl)
```

```{r}
ggplot(data = scaled.df, aes(x = MinTempMean12_22, y = BD))+
  geom_point()+
  geom_abline(mapping=aes(intercept = -4.32, slope = 0.154))
```







## Bill Depth Models

Bayesian Bill Depth GDD Incubation model

```{r BD Incubation bayes model}
BDIncub.bmdl <- stan_glm(BD ~ GDDSumIncubation * PrecipSumIncubation + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(BDIncub.bmdl), digits = 3)
#launch_shinystan(BDTime1.bmdl)
```

```{r plot BD ~ GDD Incubation model}
BDGDDIncub.plot <- plot(BDIncub.bmdl, pars = c("GDDSumIncubation","PrecipSumIncubation","Weight","CalcAge","GDDSumIncubation:PrecipSumIncubation"))
#BDGDDIncub.plot
```

<br>

A Frequentist Bill Depth GDD Time 1 model to compare with the Bayesian version

```{r BD Time 1 model}
BDTime1.scaled.mdl <- lm(data = scaled.df, BD ~ GDDSum1_11 * PrecipSum1_11 + Weight + CalcAge)
summary(BDTime1.scaled.mdl)
```

<br>

Bayesian Bill Depth GDD Time 1 model

```{r BD Time 1 bayes model}
BDTime1.bmdl <- stan_glm(BD ~ GDDSum1_11 * PrecipSum1_11 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(BDTime1.bmdl), digits = 3)
#launch_shinystan(BDTime1.bmdl)
```

```{r plot BD time 1}
BDGDDTime1.plot <- plot(BDTime1.bmdl, pars = c("GDDSum1_11","PrecipSum1_11","Weight","CalcAge","GDDSum1_11:PrecipSum1_11"))
#BDGDDTime1.plot
```

<br>

Bayesian Bill Depth GDD Time 2

```{r BD Time 2 bayes model}
BDTime2.bmdl <- stan_glm(BD ~ GDDSum12_22 * PrecipSum12_22 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(BDTime2.bmdl), digits = 3)
#launch_shinystan(BDTime1.bmdl)
```

```{r plot BD Time 2 model}
BDGDDTime2.plot <- plot(BDTime2.bmdl, pars = c("GDDSum12_22","PrecipSum12_22","Weight","CalcAge","GDDSum12_22:PrecipSum12_22"))
#BDGDDTime2.plot
```

<br>

Arrange the Bill Depth model plots

```{r ggarrange BD ~ GDD plots}
BDModelPlots.wrap <- ggarrange(BDGDDIncub.plot,BDGDDTime1.plot,BDGDDTime2.plot, ncol = 1)
annotate_figure(BDModelPlots.wrap, top = "Bill Depth Models")
```

<br>

Plot the interaction between GDD and Precip during incubation

```{r BD GDD Incubation Inter plot}
BDGDDIncubInter.plot <- plot_model(BDIncub.bmdl, type = "int", mdrt.values = "quart")

BDGDDIncubInter.plot <- BDGDDIncubInter.plot +
  scale_color_discrete(name="Precip Levels", labels=c("25th Quartile","Median", "75th Quartile"))+
  ylab("Bill Depth")+
  xlab("GDD Incubation")+
  theme(plot.title = element_blank(),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
#BDGDDIncubInter.plot
```

<br>

Plot the interaction between GDD and Precip during Time 2

```{r BD GDD Time 2 Inter plot}
BDGDDTime2Inter.plot <- plot_model(BDTime2.bmdl, type = "int", mdrt.values = "quart")

BDGDDTime2Inter.plot <- BDGDDTime2Inter.plot +
  scale_color_discrete(name="Precip Levels", labels=c("25th Quartile","Median", "75th Quartile"))+
  ylab("Bill Depth")+
  xlab("GDD Time 2")+
  theme(plot.title = element_blank(),
          axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          legend.position = "top",
          plot.margin = margin(15,15,15,15))
#BDGDDTime2Inter.plot
```

<br>

Arrange interaction plots

```{r BD arrange inter plots}
BDInterPlots.wrap <- ggarrange(BDGDDIncubInter.plot,BDGDDTime2Inter.plot, ncol = 2)
annotate_figure(BDInterPlots.wrap, top = "Bill Depth Interaction Models")
```

<br>

## Upper Bill Models

Bayesian Upper Bill Incubation model

```{r UB Incubation bayes model}
UBIncub.bmdl <- stan_glm(UB ~ GDDSumIncubation * PrecipSumIncubation + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(UBIncub.bmdl), digits = 3)
#launch_shinystan(UBTime1.bmdl)
```

```{r plot UB ~ GDD Incubation model}
UBGDDIncub.plot <- plot(UBIncub.bmdl, pars = c("GDDSumIncubation","PrecipSumIncubation","Weight","CalcAge","GDDSumIncubation:PrecipSumIncubation"))
#UBGDDIncub.plot
```

<br>

Bayesian Upper Bill GDD Time 1 model

```{r UB Time 1 bayes model}
UBTime1.bmdl <- stan_glm(UB ~ GDDSum1_11 * PrecipSum1_11 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(UBTime1.bmdl), digits = 3)
#launch_shinystan(UBTime1.bmdl)
```

```{r plot UB time 1}
UBGDDTime1.plot <- plot(UBTime1.bmdl, pars = c("GDDSum1_11","PrecipSum1_11","Weight","CalcAge","GDDSum1_11:PrecipSum1_11"))
#UBGDDTime1.plot
```

<br>

Bayesian Upper Bill GDD Time 2

```{r UB Time 2 bayes model}
UBTime2.bmdl <- stan_glm(UB ~ GDDSum12_22 * PrecipSum12_22 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(UBTime2.bmdl), digits = 3)
#launch_shinystan(UBTime1.bmdl)
```

```{r plot UB Time 2 model}
UBGDDTime2.plot <- plot(UBTime2.bmdl, pars = c("GDDSum12_22","PrecipSum12_22","Weight","CalcAge","GDDSum12_22:PrecipSum12_22"))
#UBGDDTime2.plot
```

<br>

Arrange the Upper Bill model plots

```{r ggarrange UB ~ GDD plots}
UBModelPlots.wrap <- ggarrange(UBGDDIncub.plot,UBGDDTime1.plot,UBGDDTime2.plot, ncol = 1)
annotate_figure(UBModelPlots.wrap, top = "Upper Bill Models")
```

<br>

## Upper Bill Surface Area Models

Bayesian Upper Bill Surface Area Incubation model

```{r UBS Incubation bayes model}
UBSIncub.bmdl <- stan_glm(UBS ~ GDDSumIncubation * PrecipSumIncubation + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(UBSIncub.bmdl), digits = 3)
#launch_shinystan(UBSTime1.bmdl)
```

```{r plot UBS ~ GDD Incubation model}
UBSGDDIncub.plot <- plot(UBSIncub.bmdl, pars = c("GDDSumIncubation","PrecipSumIncubation","Weight","CalcAge","GDDSumIncubation:PrecipSumIncubation"))
#UBSGDDIncub.plot
```

<br>

Bayesian Upper Bill Surface Area GDD Time 1 model

```{r UBS Time 1 bayes model}
UBSTime1.bmdl <- stan_glm(UBS ~ GDDSum1_11 * PrecipSum1_11 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(UBSTime1.bmdl), digits = 3)
#launch_shinystan(UBSTime1.bmdl)
```

```{r plot UBS time 1}
UBSGDDTime1.plot <- plot(UBSTime1.bmdl, pars = c("GDDSum1_11","PrecipSum1_11","Weight","CalcAge","GDDSum1_11:PrecipSum1_11"))
#UBSGDDTime1.plot
```

<br>

Bayesian Upper Bill Surface Area GDD Time 2

```{r UBS Time 2 bayes model}
UBSTime2.bmdl <- stan_glm(UBS ~ GDDSum12_22 * PrecipSum12_22 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(UBSTime2.bmdl), digits = 3)
#launch_shinystan(UBSTime1.bmdl)
```

```{r plot UBS Time 2 model}
UBSGDDTime2.plot <- plot(UBSTime2.bmdl, pars = c("GDDSum12_22","PrecipSum12_22","Weight","CalcAge","GDDSum12_22:PrecipSum12_22"))
#UBSGDDTime2.plot
```

<br>

Arrange the Upper Bill Surface Area model plots

```{r ggarrange UBS GDD plots}
UBSModelPlots.wrap <- ggarrange(UBSGDDIncub.plot,UBSGDDTime1.plot,UBSGDDTime2.plot, ncol = 1)
annotate_figure(UBSModelPlots.wrap, top = "Upper Bill Surface Area Models")
```

<br>

## Tarsus Models

Bayesian Tarsus Incubation model

```{r Tarsus Incubation bayes model}
TarsusIncub.bmdl <- stan_glm(Tarsus ~ GDDSumIncubation * PrecipSumIncubation + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(TarsusIncub.bmdl), digits = 3)
#launch_shinystan(TarsusIncub.bmdl)
```

```{r plot Tarsus GDD Incubation model}
TarsusGDDIncub.plot <- plot(TarsusIncub.bmdl, pars = c("GDDSumIncubation","PrecipSumIncubation","Weight","CalcAge","GDDSumIncubation:PrecipSumIncubation"))
#TarsusGDDIncub.plot
```

<br>

Bayesian Tarsus GDD Time 1 model

```{r Tarsus Time 1 bayes model}
TarsusTime1.bmdl <- stan_glm(Tarsus ~ GDDSum1_11 * PrecipSum1_11 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(TarsusTime1.bmdl), digits = 3)
#launch_shinystan(TarsusTime1.bmdl)
```

```{r plot Tarsus time 1}
TarsusGDDTime1.plot <- plot(TarsusTime1.bmdl, pars = c("GDDSum1_11","PrecipSum1_11","Weight","CalcAge","GDDSum1_11:PrecipSum1_11"))
#TarsusGDDTime1.plot
```

<br>

Bayesian Tarsus GDD Time 2

```{r Tarsus Time 2 bayes model}
TarsusTime2.bmdl <- stan_glm(Tarsus ~ GDDSum12_22 * PrecipSum12_22 + Weight + CalcAge,
                              data = scaled.df,
                              family = gaussian(),
                              algorithm = "sampling",
                              prior = student_t(df = 7, 0, 5), 
                              prior_intercept = student_t(df = 7, 0, 5),
                              cores = 2, seed = 666)
print(summary(TarsusTime2.bmdl), digits = 3)
#launch_shinystan(TarsusTime1.bmdl)
```

```{r plot Tarsus Time 2 model}
TarsusGDDTime2.plot <- plot(TarsusTime2.bmdl, pars = c("GDDSum12_22","PrecipSum12_22","Weight","CalcAge","GDDSum12_22:PrecipSum12_22"))
#TarsusGDDTime2.plot
```

<br>

Arrange the Tarsus model plots

```{r ggarrange Tarsus GDD plots}
TarsusModelPlots.wrap <-ggarrange(TarsusGDDIncub.plot,TarsusGDDTime1.plot,TarsusGDDTime2.plot, ncol = 1)
annotate_figure(TarsusModelPlots.wrap, top = "Tarsus Models")
```

<br>
