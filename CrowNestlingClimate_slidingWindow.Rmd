---
title: "Testing climwin"
author: "Justin Mann"
date: "`r Sys.Date()`"
output: html_document
---

```{r libraries, include=FALSE}
library(climwin)
library(tidyverse)
library(lubridate)
```

## Testing sliding window approach used in Liu et al. 2023 J of Avian Biol

The goal is to identify the window of time that best explains variation in nestling morphometrics. In the context of our project, this program will detect the post-hatch time period ('window' of days) over which our nestling's bills are most responsive to climatic conditions. Mathematically, it's simply running the same model, with every possible sequence of days inside a user-defined window of time, and then comparing AIC values across all models.

```{r}
egC.df <- MassClimate
egB.df <- Mass 
class(egC.df$Date)
```



```{r climate data}
#climate data
clim.df <- read.csv("ClimateMetrics_AllMonths1989-2022.csv", h=TRUE)
clim.df <- clim.df[,-1]
#coerce Date to class Date
clim.df$Date <- as.Date(clim.df$Date)
class(clim.df$Date)
clim.df$climDate <- format(strptime(clim.df$Date, format = "%Y-%m-%d"), "%d/%m/%Y")
clim.df$climDate <- str_remove(clim.df$climDate, "^0+")
clim.df$climDate <- as.factor(clim.df$climDate)
```
<br>

```{r nestling data}
#nestling data 
nestl.df <- read.csv("CrowNestlingClimate_AllNestlingsCleaned.csv", h=TRUE)
nestl.df <- nestl.df[,2:22]
#coerce Date to class Date
nestl.df$Date <- as.Date(nestl.df$Date, format = "%m/%d/%Y")
class(nestl.df$Date)
nestl.df$climDate <- format(strptime(nestl.df$Date, format = "%Y-%m-%d"), "%d/%m/%Y")
nestl.df$climDate <- str_remove(nestl.df$climDate, "^0+")
nestl.df$climDate <- as.factor(nestl.df$climDate)


#create a date that 22 days post-HatchDate
nestl.df$PostHatch22Days <- nestl.df$Date + 22
nestl.df$climDate <- format(strptime(nestl.df$PostHatch22Days, format = "%Y-%m-%d"), "%d/%m/%Y")
nestl.df$climDate <- str_remove(nestl.df$climDate, "^0+")
nestl.df$climDate <- as.factor(nestl.df$climDate)
```
<br>

```{r slidingwin test}
test1 <- slidingwin(xvar = list(C10 = clim.df$C10),
           cdate = clim.df$climDate,
           bdate = nestl.df$climDate,
           baseline = lm(BD ~ Weight + CalcAge, data = nestl.df),
           cinterval = "day",
           range = c(22,0),
           type = "relative",
           stat = "sum",
           func = "lin")
```
```{r}
test1[[1]]$Dataset
test1[[1]]$BestModel
```

